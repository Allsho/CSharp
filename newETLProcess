foreach (DataRow row in dataTable.Rows)
{
    foreach (var columnMap in mapping)
    {
        var value = row[columnMap.IncomingColumnName]?.ToString()?.Trim();

        if (string.IsNullOrWhiteSpace(value))
        {
            if (columnMap.IsRequired)
            {
                // Log or flag missing required field
            }
            continue;
        }

        switch (columnMap.DataType?.ToUpper())
        {
            case "DATETIME":
                row[columnMap.StandardizedColumnName] = ConvertExcelDate(value);
                break;

            case "INT":
                row[columnMap.StandardizedColumnName] = int.TryParse(value, out var i) ? i : (int?)null;
                break;

            case "DECIMAL":
                row[columnMap.StandardizedColumnName] = decimal.TryParse(value, out var d) ? d : (decimal?)null;
                break;

            default: // VARCHAR or unknown
                row[columnMap.StandardizedColumnName] = value;
                break;
        }
    }
}
