public void Main()
{
    ConnectionManager smtpConnection = Dts.Connections["CM_SMTP_EXHUB"];
    string smtpServer = smtpConnection.Properties["SmtpServer"].GetValue(smtpConnection).ToString();

    try
    {
        var summary = new EmailSummary();
        summary.LoadFromDatabase(Dts.Variables["User::CM_OLEDB_ClaimsStage"].Value.ToString());

        string htmlBody = summary.GenerateHtml();
        var emailer = new Emailer(Dts.Variables);

        // Send one email for all payers
        emailer.SendEmail(smtpServer, "File Processing Summary", htmlBody, "All");

        Dts.TaskResult = (int)ScriptResults.Success;
    }
    catch (Exception ex)
    {
        new Logger(Dts.Variables).LogError("SendSummaryEmail", ex.Message);
        Dts.TaskResult = (int)ScriptResults.Failure;
    }
}
